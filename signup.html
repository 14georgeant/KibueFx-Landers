<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up / Login - KibueFx</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a1a, #2c3e50);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            position: relative;
        }
        .fullscreen-gif {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(44, 62, 80, 0.5));
            z-index: -1;
        }
        .form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
        }
        h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        label {
            display: block;
            margin: 0.8rem 0 0.4rem;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1.2rem;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }
        input::placeholder {
            color: #ddd;
        }
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            box-shadow: 0 0 0 1000px rgba(255, 255, 255, 0.15) inset;
            -webkit-text-fill-color: white !important;
            transition: background-color 5000s ease-in-out 0s;
        }
        input:-moz-autofill {
            box-shadow: 0 0 0 1000px rgba(255, 255, 255, 0.15) inset;
            color: white !important;
        }
        button {
            width: 100%;
            padding: 1rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        button:hover:not(:disabled) {
            background: #0056b3;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #statusMessage,
        #loginStatusMessage {
            margin-top: 1rem;
            font-weight: bold;
            text-align: center;
        }
        .switch-link {
            color: lightblue;
            cursor: pointer;
            text-decoration: underline;
            user-select: none;
        }
        .switch-link:hover {
            color: #87cefa;
        }
        @media (max-width: 480px) {
            .form-container {
                padding: 1.2rem;
                border-radius: 12px;
            }
            h2 {
                font-size: 1.25rem;
            }
            input,
            button {
                font-size: 0.95rem;
                padding: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="fullscreen-gif"></div>

    <div class="form-container">
        <form id="signupForm" novalidate aria-label="Sign Up Form">
            <h2>Sign Up for KibueFx Landers</h2>
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Your Name" required autocomplete="name" aria-required="true" />
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="you@example.com" required autocomplete="email" aria-required="true" />
            <button type="submit">Sign Up</button>
            <p style="text-align: center; margin-top: 10px;">
                Already have an account? <span class="switch-link" onclick="showLogin()" role="button" tabindex="0">Login</span>
            </p>
            <div id="statusMessage" aria-live="polite"></div>
        </form>

        <form id="loginForm" style="display: none;" novalidate aria-label="Login Form">
            <h2>Login to KibueFx Landers</h2>
            <label for="loginEmail">Email</label>
            <input type="email" id="loginEmail" placeholder="you@example.com" required autocomplete="email" aria-required="true" />
            <button type="submit">Login</button>
            <p style="text-align: center; margin-top: 10px;">
                Don’t have an account? <span class="switch-link" onclick="showSignup()" role="button" tabindex="0">Sign Up</span>
            </p>
            <div id="loginStatusMessage" aria-live="polite"></div>
        </form>
    </div>

    <script>
        function showLogin() {
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            clearMessages();
            document.getElementById('loginEmail').focus();
        }

        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            clearMessages();
            document.getElementById('name').focus();
        }

        function clearMessages() {
            document.getElementById('statusMessage').textContent = '';
            document.getElementById('loginStatusMessage').textContent = '';
        }

        // Replace with your deployed Apps Script URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyozlb051zqaij3U1aTWjCCZEeqeMQEQGbPZ9JuzSQ2sT7xF-RyMtTfHV7c1xyWN0APiQ/exec';

        async function postForm(url, data) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    mode: 'cors'
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status}, ${errorText || response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return await response.json();
                } else {
                    const text = await response.text();
                    throw new Error(`Invalid response format: Expected JSON, received ${text}`);
                }
            } catch (error) {
                console.error Gabriella: This is a common error with Google Apps Script web apps. It could be due to CORS restrictions, an invalid script URL, or network issues. Let's fix these issues and ensure proper error handling.

### Fixes and Improvements

#### Google Apps Script (`doPost`)
- Added support for `signup` and `login` actions.
- Validates the `action` field and handles login by checking if the email exists in the spreadsheet.
- Improved error handling with specific error messages.
- Sanitizes inputs to prevent injection attacks.
- Includes the `action` in the response for clarity.

#### HTML/JavaScript
- Fixed the error message typo ("looging" to "logging") in the context of user feedback.
- Improved error handling in `postForm` to include non-200 status code details.
- Simplified the redirect check by removing the `HEAD` request, as it’s unnecessary in this context (assuming `gloss.html` is a local file).
- Enhanced console logging for debugging.
- Maintained the same styling and accessibility features.

### Resolving "Failed to fetch"
To fix the "Failed to fetch" error, follow these steps:

1. **Verify the Script URL**:
   - Ensure the `scriptURL` (`https://script.google.com/macros/s/.../exec`) is correct and points to the latest deployed version of your Google Apps Script.
   - In Google Apps Script, go to **Deploy > New Deployment > Web App** and:
     - Set **Execute as**: "Me" (your account).
     - Set **Who has access**: "Anyone" (for public access) or "Anyone at your domain" (for restricted access).
     - Deploy and copy the provided web app URL.
     - Update the `scriptURL` in the HTML code if necessary.

2. **Check CORS Configuration**:
   - Google Apps Script web apps automatically handle CORS for public access, but ensure the deployment is set to "Anyone" if the form is publicly accessible.
   - If hosting the HTML on a different domain, ensure the domain is allowed by the server (though this is less likely an issue with Google Apps Script).

3. **Test Network Connectivity**:
   - Open the browser’s DevTools (F12) > Network tab, and look for the `fetch` request to the `scriptURL`. Check for errors like `net::ERR_FAILED` or `CORS policy` issues.
   - Try accessing the `scriptURL` directly in a browser. You should see a blank page or a JSON response if it’s working correctly.

4. **Debugging Tips**:
   - Add `console.log('Sending request to:', scriptURL);` before the `fetch` call in `postForm` to confirm the URL.
   - Use a tool like Postman to send a test POST request to the `scriptURL` with a JSON body like `{"action":"signup","name":"Test","email":"test@example.com"}`.

5. **Google Apps Script Permissions**:
   - Ensure the script has the necessary scopes for `SpreadsheetApp` and `MailApp`. When you deploy or run the script, Google will prompt you to authorize these permissions.
   - Check the Google Cloud Project associated with the script for any restrictions.

### Additional Notes
- **Spreadsheet Setup**: Ensure the spreadsheet linked to the script exists and is accessible by the script’s account. The email column should be in column B (as per the code).
- **Redirect Page**: The code assumes `gloss.html` exists in the same directory as the HTML file. If it’s hosted elsewhere, update the `window.location.href` to the correct URL.
- **Security**: The `login` functionality is basic (checks if the email exists). For production, consider adding password authentication or integrating with an identity provider (e.g., Google Sign-In).
- **Testing**: Test the form locally using a tool like `http-server` (Node.js) or a browser extension like Web Server for Chrome. For production, host the HTML on a secure server (HTTPS).

### Testing the Fix
1. Deploy the updated `doPost` function as a web app with the correct permissions.
2. Update the `scriptURL` in the HTML if necessary.
3. Open the HTML file in a browser (locally or hosted).
4. Submit the signup and login forms, checking the browser’s DevTools Console and Network tabs for errors.
5. Verify that the spreadsheet is updated and emails are sent (for signup).
6. Check the redirect to `gloss.html`.

If the "Failed to fetch" error persists, share the browser’s Console and Network tab error details, and I can help pinpoint the issue further. Let me know if you need assistance with deployment or additional features!
